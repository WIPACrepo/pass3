Bootstrap: docker
From: almalinux:9.5

%post
  CPUS=20
  dnf -y install 'dnf-command(config-manager)'
  dnf config-manager --set-enabled crb
  dnf -y install epel-release
  dnf -y update && dnf -y upgrade
  dnf -y group install "Development Tools"
  mkdir -p /cvmfs/icecube.opensciencegrid.org
  mkdir /usr/local/cvmfs_src
  cd /usr/local/cvmfs_src
  git clone https://github.com/WIPACrepo/cvmfs.git --branch pass3 .
  python3 spack/build_v2.py py3-v4.4.1 --dest /cvmfs/icecube.opensciencegrid.org --src icecube.opensciencegrid.org --spack-target x86_64_v3
  python3 spack/build_v2.py py3-v4.4.1-metaprojects --dest /cvmfs/icecube.opensciencegrid.org --src icecube.opensciencegrid.org --spack-target x86_64_v3
  git clone https://github.com/WIPACrepo/pass3.git /opt/pass3
  eval `/cvmfs/icecube.opensciencegrid.org/py3-v4.4.1/setup.sh`

%runscript
  /bin/bash /cvmfs/icecube.opensciencegrid.org/py3-v4.4.1/RHEL_9_x86_64_v3/metaprojects/icetray/v1.14.0/bin/icetray-shell exec
  /bin/bash
